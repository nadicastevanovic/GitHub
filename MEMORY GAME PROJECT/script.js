let cardsEasy = ["slike/Easy/big-ben.png", 
                "slike/Easy/christ-the-redeemer.png" , 
                "slike/Easy/church-of-the-savior-on-spilled-blood.png", 
                "slike/Easy/dubai.png", "slike/Easy/eiffel-tower.png", "slike/Easy/fuji.png", 
                "slike/Easy/golden-gate-bridge.png", "slike/Easy/indonesia.png",
                "slike/Easy/big-ben.png", 
                "slike/Easy/christ-the-redeemer.png" , 
                "slike/Easy/church-of-the-savior-on-spilled-blood.png", 
                "slike/Easy/dubai.png", "slike/Easy/eiffel-tower.png", "slike/Easy/fuji.png", 
                "slike/Easy/golden-gate-bridge.png", "slike/Easy/indonesia.png"];           

let cardsMedium = ["slike/Medium/big-ben.png", 
                "slike/Medium/christ-the-redeemer.png" , 
                "slike/Medium/church-of-the-savior-on-spilled-blood.png", 
                "slike/Medium/dubai.png", "slike/Medium/eiffel-tower.png", "slike/Medium/fuji.png", 
                "slike/Medium/golden-gate-bridge.png", "slike/Medium/indonesia.png",
                "slike/Medium/istanbul.png", 
                "slike/Medium/japan.png" , 
                "slike/Medium/landmark.png", 
                "slike/Medium/opera-house.png", "slike/Medium/pisa.png", "slike/Medium/pyramid.png", 
                "slike/Medium/sphinx.png", "slike/Medium/statue-of-liberty.png",
                "slike/Medium/thailand.png", "slike/Medium/tower-bridge.png",
                "slike/Medium/big-ben.png", 
                "slike/Medium/christ-the-redeemer.png" , 
                "slike/Medium/church-of-the-savior-on-spilled-blood.png", 
                "slike/Medium/dubai.png", "slike/Medium/eiffel-tower.png", "slike/Medium/fuji.png", 
                "slike/Medium/golden-gate-bridge.png", "slike/Medium/indonesia.png",
                "slike/Medium/istanbul.png", 
                "slike/Medium/japan.png" , 
                "slike/Medium/landmark.png", 
                "slike/Medium/opera-house.png", "slike/Medium/pisa.png", "slike/Medium/pyramid.png", 
                "slike/Medium/sphinx.png", "slike/Medium/statue-of-liberty.png",
                "slike/Medium/thailand.png", "slike/Medium/tower-bridge.png"];

let cardsHard = ["slike/Hard/alien.png","slike/Hard/astronaut.png","slike/Hard/astronaut (1).png","slike/Hard/blaster.png",
                "slike/Hard/constellation.png","slike/Hard/half-moon.png","slike/Hard/lander.png",
                "slike/Hard/mars.png","slike/Hard/mercury.png","slike/Hard/meteor.png",
                "slike/Hard/meteorite (1).png","slike/Hard/monkey.png","slike/Hard/moon-rover.png",
                "slike/Hard/planet-earth.png","slike/Hard/pluto.png","slike/Hard/rocket.png",
                "slike/Hard/rocket (1).png","slike/Hard/rocket (2).png","slike/Hard/rocket-ship.png",
                "slike/Hard/satellite.png","slike/Hard/satellite (1).png","slike/Hard/satellite (2).png",
                "slike/Hard/satellite-dish.png","slike/Hard/saturn.png","slike/Hard/solar-system.png",
                "slike/Hard/solar-system (1).png","slike/Hard/space-capsule.png","slike/Hard/space-capsule (1).png",
                "slike/Hard/space-shuttle.png","slike/Hard/telescope.png","slike/Hard/ufo.png",
                "slike/Hard/uranus.png","slike/Hard/alien.png","slike/Hard/astronaut.png","slike/Hard/astronaut (1).png","slike/Hard/blaster.png",
                "slike/Hard/constellation.png","slike/Hard/half-moon.png","slike/Hard/lander.png",
                "slike/Hard/mars.png","slike/Hard/mercury.png","slike/Hard/meteor.png",
                "slike/Hard/meteorite (1).png","slike/Hard/monkey.png","slike/Hard/moon-rover.png",
                "slike/Hard/planet-earth.png","slike/Hard/pluto.png","slike/Hard/rocket.png",
                "slike/Hard/rocket (1).png","slike/Hard/rocket (2).png","slike/Hard/rocket-ship.png",
                "slike/Hard/satellite.png","slike/Hard/satellite (1).png","slike/Hard/satellite (2).png",
                "slike/Hard/satellite-dish.png","slike/Hard/saturn.png","slike/Hard/solar-system.png",
                "slike/Hard/solar-system (1).png","slike/Hard/space-capsule.png","slike/Hard/space-capsule (1).png",
                "slike/Hard/space-shuttle.png","slike/Hard/telescope.png","slike/Hard/ufo.png",
                "slike/Hard/uranus.png",];

let cardsExpert = ["slike/Hard/alien.png","slike/Hard/astronaut.png","slike/Hard/astronaut (1).png","slike/Hard/blaster.png",
                "slike/Hard/constellation.png","slike/Hard/half-moon.png","slike/Hard/lander.png",
                "slike/Hard/mars.png","slike/Hard/mercury.png","slike/Hard/meteor.png",
                "slike/Hard/meteorite (1).png","slike/Hard/monkey.png","slike/Hard/moon-rover.png",
                "slike/Hard/planet-earth.png","slike/Hard/pluto.png","slike/Hard/rocket.png",
                "slike/Hard/rocket (1).png","slike/Hard/rocket (2).png","slike/Hard/rocket-ship.png",
                "slike/Hard/satellite.png","slike/Hard/satellite (1).png","slike/Hard/satellite (2).png",
                "slike/Hard/satellite-dish.png","slike/Hard/saturn.png","slike/Hard/solar-system.png",
                "slike/Hard/solar-system (1).png","slike/Hard/space-capsule.png","slike/Hard/space-capsule (1).png",
                "slike/Hard/space-shuttle.png","slike/Hard/telescope.png","slike/Hard/ufo.png",
                "slike/Hard/uranus.png","slike/Hard/alien.png","slike/Hard/astronaut.png","slike/Hard/astronaut (1).png","slike/Hard/blaster.png",
                "slike/Hard/constellation.png","slike/Hard/half-moon.png","slike/Hard/lander.png",
                "slike/Hard/mars.png","slike/Hard/mercury.png","slike/Hard/meteor.png",
                "slike/Hard/meteorite (1).png","slike/Hard/monkey.png","slike/Hard/moon-rover.png",
                "slike/Hard/planet-earth.png","slike/Hard/pluto.png","slike/Hard/rocket.png",
                "slike/Hard/rocket (1).png","slike/Hard/rocket (2).png","slike/Hard/rocket-ship.png",
                "slike/Hard/satellite.png","slike/Hard/satellite (1).png","slike/Hard/satellite (2).png",
                "slike/Hard/satellite-dish.png","slike/Hard/saturn.png","slike/Hard/solar-system.png",
                "slike/Hard/solar-system (1).png","slike/Hard/space-capsule.png","slike/Hard/space-capsule (1).png",
                "slike/Hard/space-shuttle.png","slike/Hard/telescope.png","slike/Hard/ufo.png",
                "slike/Hard/uranus.png","slike/Medium/big-ben.png", 
                "slike/Medium/christ-the-redeemer.png" , 
                "slike/Medium/church-of-the-savior-on-spilled-blood.png", 
                "slike/Medium/dubai.png", "slike/Medium/eiffel-tower.png", "slike/Medium/fuji.png", 
                "slike/Medium/golden-gate-bridge.png", "slike/Medium/indonesia.png",
                "slike/Medium/istanbul.png", 
                "slike/Medium/japan.png" , 
                "slike/Medium/landmark.png", 
                "slike/Medium/opera-house.png", "slike/Medium/pisa.png", "slike/Medium/pyramid.png", 
                "slike/Medium/sphinx.png", "slike/Medium/statue-of-liberty.png",
                "slike/Medium/thailand.png", "slike/Medium/tower-bridge.png",
                "slike/Medium/big-ben.png", 
                "slike/Medium/christ-the-redeemer.png" , 
                "slike/Medium/church-of-the-savior-on-spilled-blood.png", 
                "slike/Medium/dubai.png", "slike/Medium/eiffel-tower.png", "slike/Medium/fuji.png", 
                "slike/Medium/golden-gate-bridge.png", "slike/Medium/indonesia.png",
                "slike/Medium/istanbul.png", 
                "slike/Medium/japan.png" , 
                "slike/Medium/landmark.png", 
                "slike/Medium/opera-house.png", "slike/Medium/pisa.png", "slike/Medium/pyramid.png", 
                "slike/Medium/sphinx.png", "slike/Medium/statue-of-liberty.png",
                "slike/Medium/thailand.png", "slike/Medium/tower-bridge.png"];

let test = ["slike/Hard/alien.png", "slike/Hard/astronaut.png","slike/Hard/alien.png", "slike/Hard/astronaut.png"];
// DOM 
let inputTimer = document.getElementById('timer');
let inputUsername = document.getElementById('userName');
let inputUsernameValue = "";
let chooseDifficultyValue = "";
let divRadioDissable = document.getElementsByClassName('rad');
let i;
for (i = 0; i < divRadioDissable.length; i++) {
    divRadioDissable[i].disabled = true;
};
let players = [];
// SHUFFLE CARDS FUNCTION
function shuffleCards(array) {
    let currentIndex = array.length; 
    let temporaryValue; 
    let randomIndex;
    while(0 !== currentIndex) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    };
    return array;
};
// TABLE GENERATING FUNCTION 
function generateCardTable(tableHeight, tableWidth, array, n) {
    let shuffled = shuffleCards(array); 
    let divTable = document.getElementById('table_game');
    let table = "<table id='gameTable' style='width:100%' class='col-6 col-t-12'>";
    for(let i = 0; i < tableHeight; i++) {
        table +=  "<tr>";
        for(let j = 0; j < tableWidth; j++) {
            table +=`<td class="cards" align="center">
                    <img id="${i*tableWidth + j}card" hidden src="${shuffled[i*tableWidth + j]}" width=100%/>
                    <img id="${i*tableWidth + j}background" src="slike/background/background.jpg" width=100%/>
                    </td>`;
        };
    };
    table += "</table>"; 
    divTable.innerHTML = table;
};
// GAME STARTING FUNCTION
function card(cardArray) {
    let counter = null;
    let alreadyOpenedCard = false;
    let oldCard;
    let firstCard;
    let secondCard;
    let cardPairs = cardArray.length / 2;
    let allowCardClicks = true;
    for(let i = 0; i < cardArray.length; i++) {
        let cardOpen = document.getElementById(`${i}card`);
        let cardClosed = document.getElementById(`${i}background`);
        cardClosed.addEventListener("click" , (event) => {
            event.preventDefault();
            for(i = 0; i < divRadioDissable.length; i++) {
                divRadioDissable[i].disabled = true;
            };
            if(counter === null) {
                counter = setInterval(() => {
                    inputTimer.value++;
                }, 1000);
            };
            if(!allowCardClicks) {
                return;
            };
            cardOpen.hidden = false;
            cardClosed.hidden = true;
            if(!alreadyOpenedCard) {
                alreadyOpenedCard = true;
                oldCard = cardOpen;
                firstCard = cardClosed;   
            } else {
                secondCard = cardClosed;
                if(oldCard == cardOpen) {
                    return;
                } else {
                    if(oldCard.src == cardOpen.src) {
                        oldCard.hidden = false;
                        alreadyOpenedCard = false;
                        cardPairs--;
                    } else {
                        allowCardClicks = false;
                        setTimeout(function() {
                            allowCardClicks = true;
                            oldCard.hidden = true;
                            cardOpen.hidden = true;
                            alreadyOpenedCard = false;
                            firstCard.hidden = false;
                            secondCard.hidden = false;
                        }, 500);
                    };
                };
                if(cardPairs == 0) {
                    clearInterval(counter);
                    counter = null;
                    if(confirm("Game ended! Would you like a new game?")) {
                        localStorage.setItem("score", inputTimer.value);
                        for(i = 0; i < divRadioDissable.length; i++) {
                            divRadioDissable[i].disabled = false;
                        };
                        players.push ({
                            "username": inputUsernameValue, 
                            "score": Number(inputTimer.value), 
                            "difficulty": chooseDifficultyValue,
                        });
                        localStorage.setItem("players" , JSON.stringify(players));
                        generateCardTable(4, 4, cardsEasy);
                        localStorage.setItem("difficulty" , chooseDifficultyValue);
                        let cardsCollection = document.getElementsByClassName('cards');
                        let cards = Array.prototype.slice.call(cardsCollection);
                        card(cards);
                        inputTimer.value= 0;
                    } else {
                        localStorage.setItem("score", inputTimer.value);
                        if(inputUsernameValue != undefined && inputUsernameValue != null) {
                            players.push ({
                                "username": inputUsernameValue, 
                                "score": Number(inputTimer.value), 
                                "difficulty": chooseDifficultyValue,
                            });
                            localStorage.setItem("players" , JSON.stringify(players));
                        };      
                    };
                };
            };
        });   
    };
}; 
// CHOOSE DIFFICULTY FUNCTION
function difficulty() {
    divRadio = document.getElementById('radioButton');
    divRadio.addEventListener('change' , (event) => {
        event.preventDefault();
        let chooseDifficulty = document.querySelector('input[name="difficulty"]:checked');
        chooseDifficultyValue = chooseDifficulty.value;
        switch(chooseDifficultyValue) {
            case "easy":
                generateCardTable(4, 4, cardsEasy);
            break;
            case "medium":
                generateCardTable(6, 6, cardsMedium);
            break;
            case "hard":
                generateCardTable(8, 8, cardsHard);
            break;
            case "expert":
                generateCardTable(10, 10, cardsExpert);
            break;
                case "test":
                generateCardTable(2, 2, test);
            break;
            default:
            alert("Nesto ne radi!");
        };
        localStorage.setItem("difficulty" , chooseDifficultyValue);
        let cardsCollection = document.getElementsByClassName('cards');
        let cards = Array.prototype.slice.call(cardsCollection);
        card(cards);        
    });
};
// USERNAME INPUT AND VERIFICATION, GAME FUNCTION 
inputUsername.addEventListener('keyup', (event) => {
    if(event.keyCode == 13) {
        event.preventDefault();
        inputUsernameValue = inputUsername.value;
        inputTimer.value = 0; 
        if(inputUsernameValue != "" && inputUsernameValue != null) {
            // staviti promenu pozadine input username kao dokaz da je pritisnut taster
            localStorage.setItem("username" , inputUsernameValue);
            for(i = 0; i < divRadioDissable.length; i++) {
                divRadioDissable[i].disabled = false;
            };
            difficulty();
        } else {
            alert("Provide valid username!");
        };
    };
});
// HIGH SCORE TABLE
let playersSession = JSON.parse(localStorage.getItem('players'));
// SORT BY DIFFICULTY
let playersEasy = [];
let playersMedium = [];
let playersHard = [];
let playersExpert = [];
for(let i = 0; i < playersSession.length; i++) {
    if(playersSession[i].difficulty == "easy"){
        playersEasy.push(playersSession[i]); 
    } else if(playersSession[i].difficulty == "medium") {
        playersMedium.push(playersSession[i]); 
    } else if(playersSession[i].difficulty == "hard") {
        playersHard.push(playersSession[i]); 
    } else if(playersSession[i].difficulty == "expert") {
        playersExpert.push(playersSession[i]); 
    }
};
// SORT AND KEEP ONLY FIRST 5
playersEasy.sort((a, b) => (a.score > b.score) ? 1 : -1);
let topFivePlayersEasy = playersEasy.slice(0, 5);

playersMedium.sort((a, b) => (a.score > b.score) ? 1 : -1);
let topFivePlayersMedium = playersMedium.slice(0, 5);

playersHard.sort((a, b) => (a.score > b.score) ? 1 : -1);
let topFivePlayersHard = playersHard.slice(0, 5);

playersExpert.sort((a, b) => (a.score > b.score) ? 1 : -1);
let topFivePlayersExpert = playersExpert.slice(0, 5);
// MAKE HIGH SCORE TABLE FUNCTION
let tableHS = array => {
    let divHighScore = document.getElementById('table_bestScores');
    let tableHS = "<table id='scores' style='width:100%'>";
    for(let i = 0; i < 1; i++) {
        tableHS += "<tr><td id='place'>PLACE</td><td id='name'>USERNAME</td><td id='time'>TIME</td></tr>";
        for(let j = 0; j < array.length; j++) {
            tableHS += `<tr><td>${j + 1}</td><td>${array[j].username}</td><td>${array[j].score}</td></tr>`;
        };
    };    
    tableHS += "</table>";
    divHighScore.innerHTML = tableHS;
};
// GENERATE TABLE
let buttonEasy = document.getElementById('EASY');
let buttonMedium = document.getElementById('MEDIUM');
let buttonHard = document.getElementById('HARD');
let buttonExpert = document.getElementById('EXPERT');
buttonEasy.addEventListener('click', (event) => {
    event.preventDefault();
    tableHS(topFivePlayersEasy);
});
buttonMedium.addEventListener('click', (event) => {
    event.preventDefault();
    tableHS(topFivePlayersMedium);
});
buttonHard.addEventListener('click', (event) => {
    event.preventDefault();
    tableHS(topFivePlayersHard);
});
buttonExpert.addEventListener('click', (event) => {
    event.preventDefault();
    tableHS(topFivePlayersExpert);
});
// PUSH TO LOCAL STORAGE
if(localStorage.getItem("players") === null) {
    localStorage.setItem("players", "[]")
}
localStorage.setItem("playersEasy", JSON.stringify(topFivePlayersEasy));
localStorage.setItem("playersMedium", JSON.stringify(topFivePlayersMedium));
localStorage.setItem("playersHard", JSON.stringify(topFivePlayersHard));
localStorage.setItem("playersExpert", JSON.stringify(topFivePlayersExpert));